!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.smacco=t():e.smacco=t()}(window,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){const i=n(1).Smacco;e.exports={Smacco:i}},function(e,t,n){!function(e){"use strict";function t(e){"smacco-1.0"==e.standard?this.config=e:console.log("Unsupported standard: "+e.standard)}t._construct=function(e){return new t(e)},t.prototype.csGenerateAccount=function(){var e=this.csGenerateHeaders(),n=[];this.config.rules?n=this.config.rules:this.config.rule&&n.push(this.config.rule);var i=[];return this.config.pubkey_list&&(i=this.config.pubkey_list),e+=t.csGeneratePubKeyList(i),"single"==this.config.input_type&&(e+=t.csGenerateSingleAccount(n,i,!this.config.default_rule&&!this.config.inline_last)),"array"==this.config.input_type&&(e+=t.csGenerateArrayAccount(n,i,!this.config.default_rule&&!this.config.inline_last)),e+=this.csGenerateFooter()},t.prototype.csGenerateHeaders=function(){return"using Neo.SmartContract.Framework;\nusing Neo.SmartContract.Framework.Services.Neo;\nusing Neo.SmartContract.Framework.Services.System;\nnamespace NeoContract1 {\npublic class Contract1 : SmartContract {\n"},t.prototype.csGenerateFooter=function(){var e="";return("disabled"==this.config.inline_last||this.config.default_rule)&&("DENY_ALL"==this.config.default_rule?e+="return false;\n":"ALLOW_ALL"==this.config.default_rule&&(e+="return true;\n")),e+="}\n}\n}\n"},t.csGeneratePubKeyList=function(e){for(var t="",n=0;n<e.length;n++)t+="public static readonly byte[] pubkey_"+n+' = "'+e[n]+'".HexToBytes();\n';return t},t.csGenerateSingleAccount=function(e,n,i=!0){for(var o="public static bool Main(byte[] signature){\n",r=0;r<e.length;r++){var u=t.csGenerateRule(e[r],n,i&&r==e.length-1);o=u.methods+o+u.main_code}return o},t.csGenerateArrayAccount=function(e,n,i=!0){for(var o="public static bool Main(byte[][] signatures){\n",r=0;r<e.length;r++){var u=t.csGenerateRule(e[r],n,i&&r==e.length-1);o=u.methods+o+u.main_code}return o},t.csGenerateRule=function(e,n,i=!1){var o=t.csGenerateCondition(e.condition,n);if(i)var r="return ("+o.condition_code+");\n";else{r="if("+o.condition_code+")\nreturn ";"DENY_IF"==e.rule_type?r+="false;\n":"ALLOW_IF"==e.rule_type&&(r+="true;\n")}return{main_code:r,methods:o.methods}},t.csGenerateCondition=function(e,n){var i="",o="";if("CHECKMULTISIG"==e.condition_type){var r=n;e.pubkeys&&(r=e.pubkeys);var u=-1;e.minimum_required&&(u=e.minimum_required),-1==u&&e.signatures&&(u=e.signatures.length);var s="";e.condition_name&&(s=e.condition_name),""==s&&(s="CheckMultiSig"+u+"_"+r.length),i=s+"(signatures)",o="public static bool "+s+"(byte[][] signatures){\nbyte[][] vpub = new[] {";for(var a=0;a<r.length;a++)o+="pubkey_"+a,a!=r.length-1&&(o+=", ");if(o+="};\nbyte[][] vsig = new[] {",e.signatures)for(var c=0;c<e.signatures.length;c++)o+="signatures["+c+"]",c!=e.signatures.length-1&&(o+=", ");else if(e.minimum_required)for(c=0;c<e.minimum_required;c++)o+="signatures["+c+"]",c!=e.minimum_required-1&&(o+=", ");o+="};\nreturn VerifySignatures(vsig, vpub);\n",o+="}\n"}else if("CHECKSIG"==e.condition_type){var l="0";e.pubkey&&(l=e.pubkey),i="VerifySignature(signature, pubkey_"+l+")",o=""}else if("TIMESTAMP_LESS"==e.condition_type){var p=0;e.timestamp&&(p=parseInt(String(e.timestamp))),e.utc&&(p=Math.round(new Date(e.utc).valueOf()/1e3)),i="Blockchain.GetHeader(Blockchain.GetHeight()).Timestamp < "+p,o=""}else if("TIMESTAMP_GREATER"==e.condition_type){p=0;e.timestamp&&(p=parseInt(String(e.timestamp))),e.utc&&(p=Math.round(new Date(e.utc).valueOf()/1e3)),i="Blockchain.GetHeader(Blockchain.GetHeight()).Timestamp > "+p,o=""}else if("SELF_TRANSFER"==e.condition_type){s="SelfTransfer";e.condition_name&&(s=e.condition_name),i=s+"()",o="public static bool "+s+"(){\nTransaction tx = (Transaction)ExecutionEngine.ScriptContainer;\nTransactionOutput[] outputs = tx.GetOutputs();\nforeach (TransactionOutput output in outputs)\nif (output.ScriptHash != ExecutionEngine.ExecutingScriptHash)\nreturn false;\nreturn true;\n",o+="}\n"}else if("ONLY_NEO"==e.condition_type){s="OnlyNeo";e.condition_name&&(s=e.condition_name),i=s+"()",o="private static readonly byte[] NeoAssetId = { 155, 124, 255, 218, 166, 116, 190, 174, 15, 147, 14, 190, 96, 133, 175, 144, 147, 229, 254, 86, 179, 74, 92, 34, 12, 205, 207, 110, 252, 51, 111, 197 };\n",o+="public static bool "+s+"(){\nTransaction tx = (Transaction)ExecutionEngine.ScriptContainer;\nTransactionOutput[] outputs = tx.GetOutputs();\nforeach (TransactionOutput output in outputs)\nif (output.AssetId != NeoAssetId)\nreturn false;\nreturn true;\n",o+="}\n"}else if("ONLY_GAS"==e.condition_type){s="OnlyGas";e.condition_name&&(s=e.condition_name),i=s+"()",o="private static readonly byte[] GasAssetId = { 231, 45, 40, 105, 121, 238, 108, 177, 183, 230, 93, 253, 223, 178, 227, 132, 16, 11, 141, 20, 142, 119, 88, 222, 66, 228, 22, 139, 113, 121, 44, 96 };\n",o+="public static bool "+s+"(){\nTransaction tx = (Transaction)ExecutionEngine.ScriptContainer;\nTransactionOutput[] outputs = tx.GetOutputs();\nforeach (TransactionOutput output in outputs)\nif (output.AssetId != GasAssetId)\nreturn false;\nreturn true;\n",o+="}\n"}else if("AND"==e.condition_type){i="",o="";for(var f=0;f<e.conditions.length;f++){i+="("+(d=t.csGenerateCondition(e.conditions[f],n)).condition_code+")",f<e.conditions.length-1&&(i+=" && "),o+=d.methods}}else if("OR"==e.condition_type)for(i="",o="",f=0;f<e.conditions.length;f++){var d;i+="("+(d=t.csGenerateCondition(e.conditions[f],n)).condition_code+")",f<e.conditions.length-1&&(i+=" || "),o+=d.methods}else i="true",o="";return{condition_code:i,methods:o}},t.prototype.generateFlowChart=function(){var e="";"single"==this.config.input_type&&(e+="input=>start: Single Signature Input|past\n"),"array"==this.config.input_type&&(e+="input=>start: Array Signature Input|past\n"),e+="accept=>end: Accept (ALLOW)|approved\n",e+="deny=>end: Reject (DENY)|rejected\n";var n="",i=[];this.config.rules?i=this.config.rules:this.config.rule&&i.push(this.config.rule),i.length>0?n+="input->Rule0\n":"ALLOW_ALL"==this.config.default_rule?n+="input->accept\n":n+="input->deny\n";var o=[];this.config.pubkey_list&&(o=this.config.pubkey_list);for(var r=!this.config.default_rule&&!this.config.inline_last,u=0;u<i.length;u++){var s=t.fcGenerateRule(i[u],u,o,r&&u==i.length-1);e+=s.declarations,n+=s.arrows}return e+n},t.fcGenerateRule=function(e,n,i,o=!1){var r="Rule"+n+"=>condition: ";r+=t.fcGenerateCondition(e.condition,i)+"\n";var u="";return o?("DENY_IF"==e.rule_type&&(u+="Rule"+n+"(yes)->deny\n",u+="Rule"+n+"(no)->accept\n"),"ALLOW_IF"==e.rule_type&&(u+="Rule"+n+"(yes)->accept\n",u+="Rule"+n+"(no)->deny\n")):("DENY_IF"==e.rule_type&&(u+="Rule"+n+"(yes)->deny\n",u+="Rule"+n+"(no)->Rule"+(n+1)+"\n"),"ALLOW_IF"==e.rule_type&&(u+="Rule"+n+"(yes)->accept\n",u+="Rule"+n+"(no)->Rule"+(n+1)+"\n")),{declarations:r,arrows:u}},t.ellipsePubkey=function(e){return e.substr(0,5)+"..."+e.slice(e.length-5)},t.fcGenerateCondition=function(e,n){var i="";if("CHECKMULTISIG"==e.condition_type){var o=n;e.pubkeys&&(o=e.pubkeys);var r=-1;e.minimum_required&&(r=e.minimum_required),-1==r&&e.signatures&&(r=e.signatures.length);e.condition_name&&e.condition_name,i="CheckMultiSig("+r,i+=" / "+o.length+")"}else if("CHECKSIG"==e.condition_type){var u="0";e.pubkey&&(u=e.pubkey),u.length<=2&&(u=n[new Number(u)]),i="CheckSig("+t.ellipsePubkey(u)+")"}else if("TIMESTAMP_LESS"==e.condition_type){var s=0;e.timestamp&&(s=parseInt(String(e.timestamp))),e.utc&&(s=Math.round(new Date(e.utc).valueOf()/1e3)),i="Before "+((a=new Date(1e3*s)).toISOString().split("T")[0]+" "+a.toISOString().split("T")[1].split("Z")[0].substr(0,8)+"Z")}else if("TIMESTAMP_GREATER"==e.condition_type){var a;s=0;e.timestamp&&(s=parseInt(String(e.timestamp))),e.utc&&(s=Math.round(new Date(e.utc).valueOf()/1e3)),i="After "+((a=new Date(1e3*s)).toISOString().split("T")[0]+" "+a.toISOString().split("T")[1].split("Z")[0].substr(0,8)+"Z")}else if("SELF_TRANSFER"==e.condition_type)i="SelfTransfer";else if("ONLY_NEO"==e.condition_type)i="OnlyNeo";else if("ONLY_GAS"==e.condition_type)i="OnlyGas";else if("AND"==e.condition_type)for(var c=0;c<e.conditions.length;c++){i+="("+t.fcGenerateCondition(e.conditions[c],n)+")",c<e.conditions.length-1&&(i+=" && ")}else if("OR"==e.condition_type)for(c=0;c<e.conditions.length;c++){i+="("+t.fcGenerateCondition(e.conditions[c],n)+")",c<e.conditions.length-1&&(i+=" || ")}else i="true";return i},e.Smacco=t}(t)}])});